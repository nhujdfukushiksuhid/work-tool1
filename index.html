<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬æ¡ˆä½œæˆã‚µãƒãƒ¼ãƒˆAI - æ”¯æ´è¨ˆç”»ã®ç´ </title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.mini.min.js"></script>
    <style>
        /* --- ãƒ‡ã‚¶ã‚¤ãƒ³å®šç¾© (è¦ªã—ã¿ã‚„ã™ã•ãƒ»å®‰å¿ƒæ„Ÿ) --- */
        :root {
            /* æ¸©ã‹ã¿ã®ã‚ã‚‹ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ (ã‚ªãƒ¬ãƒ³ã‚¸/ãƒ™ãƒ¼ã‚¸ãƒ¥ç³») */
            --primary: #f59e0b; 
            --primary-light: #fef3c7;
            --primary-dark: #d97706;
            
            /* å®‰å¿ƒæ„Ÿã®ã‚ã‚‹ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ (ã‚°ãƒªãƒ¼ãƒ³ç³») */
            --accent: #10b981;
            
            /* èƒŒæ™¯ã¨æ–‡å­— */
            --bg-color: #fffaf0; /* çœŸã£ç™½ã§ã¯ãªãã‚¯ãƒªãƒ¼ãƒ è‰² */
            --surface: #ffffff;
            --text-main: #4b5563; /* çœŸã£é»’ã§ã¯ãªãæ¿ƒã„ã‚°ãƒ¬ãƒ¼ */
            --text-bold: #1f2937;
            
            --radius: 1rem; /* ä¸¸ã¿ã‚’å¼·èª¿ */
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
        }

        * { box-sizing: border-box; }
        body {
            font-family: "Hiragino Maru Gothic Pro", "Meiryo UI", sans-serif; /* ä¸¸ã‚´ã‚·ãƒƒã‚¯ç³»ã‚’å„ªå…ˆ */
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0; padding: 0; line-height: 1.6;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; }

        /* --- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ --- */
        header { text-align: center; margin-bottom: 3rem; }
        h1 { 
            color: var(--text-bold); 
            font-size: 2rem; 
            margin-bottom: 0.5rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .subtitle { font-size: 1.1rem; color: var(--text-main); margin-bottom: 2rem; }

        /* --- ãƒ¡ãƒªãƒƒãƒˆè¨´æ±‚ã‚¨ãƒªã‚¢ (3ã¤ã®ç‰¹å¾´) --- */
        .features {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }
        .feature-box {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 300px;
            text-align: center;
            border-bottom: 5px solid var(--primary);
        }
        .feature-icon { font-size: 2.5rem; margin-bottom: 1rem; display: block; }
        .feature-title { font-weight: bold; font-size: 1.1rem; color: var(--text-bold); margin-bottom: 0.5rem; }
        .feature-desc { font-size: 0.9rem; color: var(--text-main); }

        /* --- ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ (ã‚„ã‚ã‚‰ã‹ã) --- */
        .upload-card {
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            border: 2px dashed #cbd5e1;
        }
        .drop-zone {
            background-color: var(--primary-light);
            border: 3px dashed var(--primary);
            border-radius: var(--radius);
            padding: 4rem 2rem;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
        }
        .drop-zone:hover {
            transform: scale(1.02);
            background-color: #fde68a;
        }
        .drop-message-main {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 1rem;
        }
        .drop-message-sub { font-size: 1rem; color: var(--text-main); }

        /* --- çµæœè¡¨ç¤ºãƒ†ãƒ¼ãƒ–ãƒ« --- */
        .result-area { display: none; } /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
        .result-area.active { display: block; animation: fadeIn 0.5s; }

        .controls {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 1rem; background: var(--surface); padding: 1rem;
            border-radius: var(--radius); box-shadow: var(--shadow);
        }
        
        .btn-group { display: flex; gap: 10px; }
        button {
            border: none; padding: 0.8rem 1.5rem;
            border-radius: 50px; /* ä¸¸ãƒœã‚¿ãƒ³ */
            font-weight: bold; cursor: pointer; font-size: 1rem;
            display: flex; align-items: center; gap: 0.5rem;
            transition: all 0.2s;
        }
        /* ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */
        .btn-primary { background-color: var(--accent); color: white; box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3); }
        .btn-primary:hover { background-color: #059669; transform: translateY(-2px); }
        /* ã‚µãƒ–ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */
        .btn-secondary { background-color: white; color: var(--text-main); border: 2px solid #e5e7eb; }
        .btn-secondary:hover { background-color: #f3f4f6; }

        /* ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .table-wrap {
            overflow-x: auto;
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid #e5e7eb;
            max-height: 600px;
        }
        table { width: 100%; border-collapse: collapse; white-space: nowrap; }
        th, td { padding: 12px 16px; text-align: left; border-bottom: 1px solid #f3f4f6; }
        th {
            background-color: var(--primary-light);
            color: var(--primary-dark);
            font-weight: bold;
            position: sticky; top: 0; z-index: 10;
        }
        /* åˆ—ã”ã¨ã®èƒŒæ™¯è‰²ï¼ˆã†ã£ã™ã‚‰ã¨ï¼‰ */
        td.col-life { background-color: #fff7ed; } /* ã‚ªãƒ¬ãƒ³ã‚¸è–„ */
        td.col-work { background-color: #eff6ff; } /* é’è–„ */
        td.col-future { background-color: #f5f3ff; } /* ç´«è–„ */
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(255,255,255,0.9);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999; display: none;
        }
        .overlay.active { display: flex; }
        .spinner {
            width: 60px; height: 60px;
            border: 6px solid #f3f4f6; border-top: 6px solid var(--primary);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1><span style="font-size:2.5rem;">ğŸŒ±</span> æœ¬æ¡ˆä½œæˆã‚µãƒãƒ¼ãƒˆAI <span style="font-size:1.2rem; color:#666; font-weight:normal; margin-left:10px;">- æ”¯æ´è¨ˆç”»ã®ç´ ï¼ˆã‚‚ã¨ï¼‰ -</span></h1>
        <p class="subtitle">ã€Œäº‹å‹™ä½œæ¥­ã€ã‚’ã€Œå‰µé€ çš„ãªæ™‚é–“ã€ã¸ã€‚ã‚ãªãŸã®è¨ˆç”»æ›¸ä½œã‚Šã‚’ãŠæ‰‹ä¼ã„ã—ã¾ã™ã€‚</p>

        <div class="features">
            <div class="feature-box">
                <span class="feature-icon">ğŸ”’</span>
                <div class="feature-title">å®‰å¿ƒã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</div>
                <div class="feature-desc">ãƒ‡ãƒ¼ã‚¿ã¯ã©ã“ã«ã‚‚é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚<br>ã‚ãªãŸã®ãƒ‘ã‚½ã‚³ãƒ³ã®ä¸­ã ã‘ã§å‹•ãã®ã§ã€<br>å€‹äººæƒ…å ±ã‚‚å®‰å¿ƒã§ã™ã€‚</div>
            </div>
            <div class="feature-box">
                <span class="feature-icon">âœ¨</span>
                <div class="feature-title">æ–‡ç« ã®ä½¿ã„å›ã—ã‚¼ãƒ­</div>
                <div class="feature-desc">AIãŒæ¯å›é•ã†è¡¨ç¾ã§æ–‡ç« ã‚’ä½œã‚Šã¾ã™ã€‚<br>ã€Œã‚³ãƒ”ãƒšæ„Ÿã€ã®ãªã„ã€<br>ä¸€äººã²ã¨ã‚Šã«å¯„ã‚Šæ·»ã£ãŸè¨ˆç”»æ›¸ã«ã€‚</div>
            </div>
            <div class="feature-box">
                <span class="feature-icon">âš¡</span>
                <div class="feature-title">Excelãã®ã¾ã¾æ´»ç”¨</div>
                <div class="feature-desc">ä»Šã‚ã‚‹æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã™ã‚‹ã ã‘ã€‚<br>é¢å€’ãªè¨­å®šã¯ä¸€åˆ‡ä¸è¦ã€‚<br>å®Œæˆå“ã‚‚Excelã§ä¿å­˜ã§ãã¾ã™ã€‚</div>
            </div>
        </div>
    </header>

    <div class="upload-card">
        <div id="dropZone" class="drop-zone">
            <div class="drop-message-main">å…¨åˆ©ç”¨è€…ã®æ—¥å ±Excelãƒ‡ãƒ¼ã‚¿ã‚’ã€<br>ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„</div>
            <div class="drop-message-sub">ï¼ˆã¾ãŸã¯ã€ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠï¼‰</div>
            <input type="file" id="fileInput" accept=".xlsx, .xls" style="display:none">
        </div>
    </div>

    <div id="loadingOverlay" class="overlay">
        <div class="spinner"></div>
        <h2 style="margin-top:20px; color:var(--text-bold);">AIãŒæ–‡ç« ã‚’è€ƒãˆã¦ã„ã¾ã™...</h2>
        <p>æ•°ç§’ãŠå¾…ã¡ãã ã•ã„</p>
    </div>

    <div id="resultSection" class="result-area">
        <div class="controls">
            <div style="font-weight:bold; font-size:1.2rem;">
                âœ… <span id="countText">0</span> ååˆ†ã®æ¡ˆãŒã§ãã¾ã—ãŸ
            </div>
            <div class="btn-group">
                <button class="btn-secondary" id="retryBtn">ğŸ”„ åˆ¥ã®è¡¨ç¾ã§ä½œã‚Šç›´ã™</button>
                <button class="btn-secondary" id="copyBtn">ğŸ“‹ ã‚³ãƒ”ãƒ¼ã™ã‚‹</button>
                <button class="btn-primary" id="downloadBtn">ğŸ’¾ Excelç”¨ã«ä¿å­˜</button>
            </div>
        </div>

        <div class="table-wrap">
            <table id="resultTable">
                <thead>
                    <tr>
                        <th style="min-width:120px;">ãŠåå‰</th>
                        <th>ã‚¿ã‚¤ãƒ—</th>
                        <th style="min-width:300px;">ç·åˆçš„ãªæ”¯æ´ã®æ–¹é‡</th>
                        <th style="min-width:300px;">é•·æœŸç›®æ¨™</th>
                        <th style="min-width:300px;">çŸ­æœŸç›®æ¨™</th>
                        <th style="min-width:250px; background:#fff7ed;">ç›®æ¨™1 (ç”Ÿæ´»ãƒ»é‡‘éŠ­)</th>
                        <th style="min-width:250px; background:#fff7ed;">æ”¯æ´1</th>
                        <th style="min-width:250px; background:#eff6ff;">ç›®æ¨™2 (ä½œæ¥­ãƒ»å¯¾äºº)</th>
                        <th style="min-width:250px; background:#eff6ff;">æ”¯æ´2</th>
                        <th style="min-width:250px; background:#f5f3ff;">ç›®æ¨™3 (å°±åŠ´ãƒ»æŒ‘æˆ¦)</th>
                        <th style="min-width:250px; background:#f5f3ff;">æ”¯æ´3</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <p style="margin-top:10px; font-size:0.9rem; text-align:right;">â€»ã“ã®è¡¨ã‚’Excelã«è²¼ã‚Šä»˜ã‘ã¦èª¿æ•´ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

</div>

<script>
/* * å†…éƒ¨ãƒ­ã‚¸ãƒƒã‚¯: ãƒ†ãƒ¼ãƒåˆ¥ã‚¹ãƒ­ãƒƒãƒˆãƒã‚·ãƒ³ & ãƒ¦ãƒ‹ãƒ¼ã‚¯ç”Ÿæˆã‚¨ãƒ³ã‚¸ãƒ³
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¦‹ãˆãªã„è£å´ã§ã€è¤‡é›‘ãªè¨ˆç®—ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚
 */

// --- 1. æ–‡ç« ãƒ‘ãƒ¼ãƒ„ã®è¾æ›¸ (è†¨å¤§ãªçµ„ã¿åˆã‚ã›ã®æº) ---
const DICT = {
    // å…±é€šéƒ¨å“
    sub: ["æœ¬äººã¯", "åˆ©ç”¨è€…ã¯", "ã”æœ¬äººã¯", "å¯¾è±¡è€…ã¯", "å½“è©²ãƒ¡ãƒ³ãƒãƒ¼ã¯"],
    conn: ["ã¾ãŸã€", "ã•ã‚‰ã«ã€", "åŠ ãˆã¦ã€", "ä½µã›ã¦ã€", "ãã®ä¸Šã§ã€", "ä¸¦è¡Œã—ã¦ã€"],
    adv: ["ç€å®Ÿã«", "æ®µéšçš„ã«", "ç²˜ã‚Šå¼·ã", "æ„æ¬²çš„ã«", "ä¸»ä½“çš„ã«", "å®‰å®šã—ã¦", "å°‘ã—ãšã¤", "è‡ªä¿¡ã‚’æŒã£ã¦"],
    
    // æ–‡æœ«è¡¨ç¾
    end_policy: ["æ”¯æ´ã‚’è¡Œã†ã€‚", "ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãã€‚", "æ”¯æ´ã‚’å±•é–‹ã™ã‚‹ã€‚", "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ã€‚", "ç’°å¢ƒã‚’æ•´ãˆã‚‹ã€‚", "ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’è¡Œã†ã€‚"],
    end_will: ["ç›®æŒ‡ã™ã€‚", "å›³ã‚‹ã€‚", "å¿—å‘ã™ã‚‹ã€‚", "ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹ã€‚", "ç›®æ¨™ã¨ã™ã‚‹ã€‚", "é€²ã‚ã¦ã„ãã€‚", "å–ã‚Šçµ„ã‚€ã€‚"],
    end_do: ["è¡Œã„ã¾ã™ã€‚", "å®Ÿæ–½ã—ã¾ã™ã€‚", "æä¾›ã—ã¾ã™ã€‚", "ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚", "ä¿ƒã—ã¾ã™ã€‚", "åŠ©è¨€ã—ã¾ã™ã€‚", "è¦‹å®ˆã‚Šã¾ã™ã€‚"],

    // ã‚¿ã‚¤ãƒ—åˆ¥ãƒ‘ãƒ¼ãƒ„ (Excelã®åˆ†æçµæœã‹ã‚‰è‡ªå‹•é¸æŠ)
    types: {
        A: { // å°±åŠ´ãƒ»ã‚¹ã‚­ãƒ«
            intro: ["æœ¬äººã®å¼·ã„å°±åŠ´æ„æ¬²ã‚’å°Šé‡ã—ã€", "ä¼æ¥­å°±åŠ´ã¸ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¦‹æ®ãˆã€", "è‡ªèº«ã®é©æ€§ã‚’æ´»ã‹ã—ãŸåƒãæ–¹ã‚’ç›®æŒ‡ã—ã€"],
            focus: ["å®Ÿå‹™ã‚¹ã‚­ãƒ«ã®å‘ä¸Šã‚’é‡ç‚¹çš„ã«", "å°±åŠ´æº–å‚™æ€§ã®ç²å¾—ã‚’ä¸­å¿ƒã«", "è·æ¥­èƒ½åŠ›ã®åº•ä¸Šã’ã‚’ä¸»è»¸ã«"],
            long: ["ä¸€èˆ¬å°±åŠ´ã«å‘ã‘ãŸå®Ÿè·µåŠ›ã®ç²å¾—ã‚’", "ä¼æ¥­ã§é€šç”¨ã™ã‚‹ã‚¹ã‚­ãƒ«ã®ç¢ºç«‹ã‚’", "è‡ªç«‹ã—ãŸç¤¾ä¼šç”Ÿæ´»ã¨å°±åŠ´ã®ä¸¡ç«‹ã‚’"],
            short: ["ä½œæ¥­ç²¾åº¦ã®å‘ä¸Šã¨å®‰å®šåŒ–ã‚’", "åŸºæœ¬ä½œæ¥­ã‚¹ã‚­ãƒ«ã®ç¿’å¾—ã‚’", "æ¥­å‹™ä¸Šã®å ±é€£ç›¸ã®å®šç€ã‚’"]
        },
        B: { // ä½“èª¿ãƒ»ãƒ¡ãƒ³ã‚¿ãƒ«
            intro: ["å¿ƒèº«ã®å¥åº·ç¶­æŒã‚’æœ€å„ªå…ˆäº‹é …ã¨ã—ã€", "å®‰å®šã—ãŸé€šæ‰€ãƒªã‚ºãƒ ã®ç¢ºç«‹ã‚’ç›®æŒ‡ã—ã€", "ç„¡ç†ã®ãªã„ãƒšãƒ¼ã‚¹ã§ã®ç¤¾ä¼šå‚åŠ ã‚’é‡è¦–ã—ã€"],
            focus: ["ç”Ÿæ´»ãƒªã‚ºãƒ ã®å®‰å®šåŒ–ã‚’ä¸­å¿ƒã«", "ã‚¹ãƒˆãƒ¬ã‚¹å¯¾å‡¦èƒ½åŠ›ã®å‘ä¸Šã‚’è»¸ã«", "è‡ªå·±ç®¡ç†ã‚¹ã‚­ãƒ«ã®ç²å¾—ã‚’ç›®æ¨™ã«"],
            long: ["å¿ƒèº«å…±ã«å®‰å®šã—ãŸç¤¾ä¼šç”Ÿæ´»ã®ç¶­æŒã‚’", "ç‹¬è‡ªã®å¥åº·ç®¡ç†æ‰‹æ³•ã®ç¢ºç«‹ã‚’", "é•·æœŸçš„ãªæ´»å‹•ç¶™ç¶šã®åŸºç›¤ä½œã‚Šã‚’"],
            short: ["é€šæ‰€ãƒªã‚ºãƒ ã®å®‰å®šã¨ç¶­æŒã‚’", "ä¸èª¿æ™‚ã®æ—©æœŸå¯¾å‡¦ã‚¹ã‚­ãƒ«ã®ç¿’å¾—ã‚’", "æ´»å‹•ã¨ä¼‘æ†©ã®ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ã‚’"]
        },
        C: { // å¯¾äººãƒ»æƒ…ç·’
            intro: ["é›†å›£å†…ã§ã®å††æ»‘ãªé–¢ä¿‚æ§‹ç¯‰ã‚’ç›®æŒ‡ã—ã€", "ä»–è€…ã¨ã®é©åˆ‡ãªè·é›¢æ„Ÿã®ç¿’å¾—ã‚’ãƒ†ãƒ¼ãƒã¨ã—ã€", "ç¤¾ä¼šæ€§ã®å‘ä¸Šã‚’ä¸»è¦ãªèª²é¡Œã¨æ‰ãˆã€"],
            focus: ["ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ«ã®å‘ä¸Šã‚’", "å¯¾äººãƒˆãƒ©ãƒ–ãƒ«ã®æœªç„¶é˜²æ­¢ã‚’", "å”èª¿æ€§ã®æ¶µé¤Šã‚’"],
            long: ["é›†å›£ã®ä¸­ã§ã®é©åˆ‡ãªæŒ¯ã‚‹èˆã„ã®å®šç€ã‚’", "å††æ»‘ãªå¯¾äººé–¢ä¿‚ã®æ§‹ç¯‰ã¨ç¶­æŒã‚’", "æ„Ÿæƒ…ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«èƒ½åŠ›ã®ç¢ºç«‹ã‚’"],
            short: ["å ´é¢ã«å¿œã˜ãŸè¨€è‘‰é£ã„ã®ç¿’å¾—ã‚’", "ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã®å†·é™ãªå¯¾å‡¦ã®å®Ÿè·µã‚’", "é›†å›£ãƒ«ãƒ¼ãƒ«ã¸ã®é©å¿œã‚’"]
        },
        D: { // ç”Ÿæ´»ãƒ»åŸºç¤
            intro: ["è‡ªç«‹ã—ãŸæ—¥å¸¸ç”Ÿæ´»ã®å®Ÿç¾ã«å‘ã‘ã€", "ç¤¾ä¼šäººã¨ã—ã¦ã®åŸºç¤ãƒãƒŠãƒ¼å®šç€ã‚’ç›®æŒ‡ã—ã€", "åŸºæœ¬çš„ãªç”Ÿæ´»ç¿’æ…£ã®ç¢ºç«‹ã‚’ç¬¬ä¸€ã¨ã—ã€"],
            focus: ["èº«ã ã—ãªã¿ã‚„æŒ¨æ‹¶ã®ç¿’æ…£åŒ–ã‚’", "ãƒ«ãƒ¼ãƒ«éµå®ˆã®å¾¹åº•ã‚’", "æ•´ç†æ•´é “ã‚„è¡›ç”Ÿç®¡ç†ã®å®šç€ã‚’"],
            long: ["ç¤¾ä¼šäººã¨ã—ã¦ã®åŸºç¤çš„ãƒãƒŠãƒ¼ã®ç¢ºç«‹ã‚’", "è‡ªç«‹çš„ãªæ—¥å¸¸ç”Ÿæ´»ã®å®Ÿè·µã‚’", "å‘¨å›²ã‹ã‚‰ä¿¡é ¼ã•ã‚Œã‚‹è¡Œå‹•ç¿’æ…£ã®å®šç€ã‚’"],
            short: ["æŒ¨æ‹¶ã‚„èº«ã ã—ãªã¿ã®ç¿’æ…£åŒ–ã‚’", "åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«ã®ç†è§£ã¨éµå®ˆã‚’", "æ•´ç†æ•´é “ã®å¾¹åº•ã‚’"]
        }
    },

    // å›ºå®šãƒ†ãƒ¼ãƒã‚¹ãƒ­ãƒƒãƒˆ (1:ç”Ÿæ´», 2:ä½œæ¥­, 3:å°±åŠ´)
    slots: {
        slot1: { // ç”Ÿæ´»ãƒ»é‡‘éŠ­
            acts: [
                "æ¸…æ½”æ„Ÿã®ã‚ã‚‹èº«ã ã—ãªã¿ã‚’ä¿ã¤", "é‡‘éŠ­ç®¡ç†ã‚’è¨ˆç”»çš„ã«è¡Œã†", "æŒ¨æ‹¶ã‚„è¿”äº‹ã‚’ãƒã‚­ãƒã‚­ã¨è¡Œã†", 
                "ç”Ÿæ´»ãƒªã‚ºãƒ ã‚’æ•´ãˆé…åˆ»ã‚’æ¸›ã‚‰ã™", "èº«è¿‘ãªåŒåƒšã¨ç©ã‚„ã‹ã«æ¥ã™ã‚‹", "è¨€è‘‰é£ã„ã‚’ä¸å¯§ã«ã™ã‚‹",
                "ç§ç‰©ã®æ•´ç†æ•´é “ã‚’å¾¹åº•ã™ã‚‹", "æ‰‹æ´—ã„ãƒ»ã†ãŒã„ã§å¥åº·ç®¡ç†ã‚’è¡Œã†", "ãŠå°é£ã„å¸³ã‚’ã¤ã‘ã¦ç„¡é§„é£ã„ã‚’é˜²ã"
            ],
            sups: [
                "èº«ã ã—ãªã¿ãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆã®æ´»ç”¨", "é‡‘éŠ­å‡ºç´å¸³ã®è¨˜å…¥ã‚µãƒãƒ¼ãƒˆ", "æœç¤¼æ™‚ã®æŒ¨æ‹¶ç·´ç¿’", 
                "ç”Ÿæ´»ãƒªã‚ºãƒ è¡¨ã«ã‚ˆã‚‹æŒ¯ã‚Šè¿”ã‚Š", "SSTã‚’é€šã˜ãŸå¯¾äººè·é›¢æ„Ÿã®å­¦ç¿’", "ä¸å¯§èªãƒ»æ•¬èªã®ãƒ¢ãƒ‡ãƒªãƒ³ã‚°æç¤º",
                "æ•´ç†æ•´é “ã‚¿ã‚¤ãƒ ã®è¨­å®šã¨å£°æ›ã‘", "è¡›ç”Ÿãƒã‚¹ã‚¿ãƒ¼ã®æ²ç¤ºã¨ç¢ºèª", "é‡‘éŠ­ç®¡ç†ã®ç›¸è«‡å¯¾å¿œ"
            ]
        },
        slot2: { // ä½œæ¥­ãƒ»å¯¾äºº
            acts: [
                "ä½œæ¥­æ‰‹é †æ›¸é€šã‚Šã«æ­£ç¢ºã«é€²ã‚ã‚‹", "é›†ä¸­ã‚’æŒç¶šã•ã›ãƒŸã‚¹ã‚’æ¸›ã‚‰ã™", "å ±å‘Šãƒ»é€£çµ¡ãƒ»ç›¸è«‡ã‚’è‡ªç™ºçš„ã«è¡Œã†",
                "ä¸æ˜ç‚¹ã¯ãã®ã¾ã¾ã«ã›ãšè³ªå•ã™ã‚‹", "å…±åŒä½œæ¥­ã§ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æ„è­˜ã™ã‚‹", "ä½œæ¥­çµ‚äº†å¾Œã®å¾Œç‰‡ä»˜ã‘ã¾ã§è²¬ä»»ã‚’æŒã¤",
                "ç´æœŸã‚„æ™‚é–“ã‚’æ„è­˜ã—ã¦å–ã‚Šçµ„ã‚€", "ä¸å¯§ãªä½œæ¥­ã§è‰¯å“ç‡ã‚’ä¸Šã’ã‚‹", "ç§èªã‚’æ…ã¿æ‰‹å…ƒã«é›†ä¸­ã™ã‚‹"
            ],
            sups: [
                "å†™çœŸä»˜ããƒãƒ‹ãƒ¥ã‚¢ãƒ«ã®æä¾›", "é›†ä¸­ã§ãã‚‹ç’°å¢ƒï¼ˆè¡ç«‹ç­‰ï¼‰ã®èª¿æ•´", "å ±é€£ç›¸ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤",
                "è³ªå•ã—ã‚„ã™ã„é›°å›²æ°—ä½œã‚Šã¨å£°æ›ã‘", "ãƒšã‚¢ä½œæ¥­ã®è¨­å®šã¨ä»²ä»‹", "ä½œæ¥­å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã®æ´»ç”¨",
                "ã‚¿ã‚¤ãƒãƒ¼ã‚’ç”¨ã„ãŸæ™‚é–“ç®¡ç†æ”¯æ´", "æ¤œå“ä½œæ¥­ã‚’é€šã˜ãŸå“è³ªæ„è­˜ã®å‘ä¸Š", "é›†ä¸­ã‚¿ã‚¤ãƒ ã¨ä¼‘æ†©ã®ãƒ¡ãƒªãƒãƒªä»˜ã‘"
            ]
        },
        slot3: { // å°±åŠ´ãƒ»æœªæ¥
            acts: [
                "æ–½è¨­å¤–å°±åŠ´ã§å®Ÿè·µçš„ãªçµŒé¨“ã‚’ç©ã‚€", "ä¸€èˆ¬å°±åŠ´ã«å‘ã‘ã¦æ±‚äººæ¤œç´¢ã‚’è¡Œã†", "PCã‚¹ã‚­ãƒ«ï¼ˆExcel/Wordï¼‰ã‚’å¿œç”¨ãƒ¬ãƒ™ãƒ«ã¸é«˜ã‚ã‚‹",
                "å¸Œæœ›è·ç¨®ã«å¿…è¦ãªè³‡æ ¼å–å¾—ã«æŒ‘æˆ¦ã™ã‚‹", "å±¥æ­´æ›¸ã‚„è·å‹™çµŒæ­´æ›¸ã®ä½œæˆã‚’é€²ã‚ã‚‹", "é¢æ¥ç·´ç¿’ã‚’é€šã˜ã¦è‡ªå·±PRã‚’ç£¨ã",
                "æ–°ã—ã„ä½œæ¥­ç¨®ç›®ã«ã‚‚ç©æ¥µçš„ã«æŒ‘ã‚€", "ä¼æ¥­å®Ÿç¿’ã«å‚åŠ ã—ç¾å ´ã®ç©ºæ°—ã‚’çŸ¥ã‚‹", "ãƒ“ã‚¸ãƒã‚¹ãƒãƒŠãƒ¼ã‚’ç¿’å¾—ã—å®Ÿè·µã™ã‚‹"
            ],
            sups: [
                "æ–½è¨­å¤–å°±åŠ´å…ˆã§ã®åŒè¡Œæ”¯æ´", "ãƒãƒ­ãƒ¼ãƒ¯ãƒ¼ã‚¯åŒè¡Œã¨æ¤œç´¢æ©Ÿåˆ©ç”¨è£œåŠ©", "å¿œç”¨èª²é¡Œãƒ—ãƒªãƒ³ãƒˆã®æä¾›ã¨æ·»å‰Š",
                "è³‡æ ¼è©¦é¨“ã®è¨ˆç”»ç­–å®šã¨å­¦ç¿’ã‚µãƒãƒ¼ãƒˆ", "å¿œå‹Ÿæ›¸é¡ã®æ·»å‰Šã¨ä½œæˆè£œåŠ©", "æ¨¡æ“¬é¢æ¥ã®å®Ÿæ–½ã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯",
                "æ–°è¦ä½œæ¥­ã®å°å…¥ã¨ä¸å¯§ãªåˆæœŸæŒ‡å°", "å®Ÿç¿’å…ˆã®é–‹æ‹“ã¨èª¿æ•´", "ãƒ“ã‚¸ãƒã‚¹ãƒãƒŠãƒ¼ç ”ä¿®ã®å®Ÿæ–½"
            ]
        }
    }
};

// é‡è¤‡ãƒã‚§ãƒƒã‚¯ç”¨ãƒ¡ãƒ¢ãƒª
const history = new Set();
let lastWorkbook = null;

// --- ç”»é¢æ“ä½œã‚¤ãƒ™ãƒ³ãƒˆ ---
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const loading = document.getElementById('loadingOverlay');
const resultSection = document.getElementById('resultSection');
const tbody = document.querySelector('#resultTable tbody');

// ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã®æ¼”å‡º
dropZone.onclick = () => fileInput.click();
dropZone.ondragover = (e) => { e.preventDefault(); dropZone.style.backgroundColor = '#fde68a'; };
dropZone.ondragleave = () => dropZone.style.backgroundColor = '#fef3c7';
dropZone.ondrop = (e) => { 
    e.preventDefault(); 
    dropZone.style.backgroundColor = '#fef3c7'; 
    if(e.dataTransfer.files[0]) startProcess(e.dataTransfer.files[0]); 
};
fileInput.onchange = (e) => { if(e.target.files[0]) startProcess(e.target.files[0]); };

// ãƒœã‚¿ãƒ³æ“ä½œ
document.getElementById('retryBtn').onclick = () => { if(lastWorkbook) render(lastWorkbook); };
document.getElementById('copyBtn').onclick = copyToClipboard;
document.getElementById('downloadBtn').onclick = downloadCSV;

// --- å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ ---

async function startProcess(file) {
    loading.classList.add('active'); // ãã‚‹ãã‚‹è¡¨ç¤º
    history.clear(); // å±¥æ­´ãƒªã‚»ãƒƒãƒˆ
    
    // å°‘ã—å¾…ãŸã›ã¦ã€Œè€ƒãˆã¦ã„ã‚‹æ„Ÿã€ã‚’å‡ºã™æ¼”å‡º
    await new Promise(r => setTimeout(r, 800));

    try {
        const data = await file.arrayBuffer();
        const workbook = XLSX.read(data, { type: 'array' });
        lastWorkbook = workbook;
        render(workbook);
        
        loading.classList.remove('active');
        resultSection.classList.add('active');
        // ã‚¹ãƒ ãƒ¼ã‚ºã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        resultSection.scrollIntoView({ behavior: 'smooth' });

    } catch (e) {
        loading.classList.remove('active');
        alert("ã”ã‚ã‚“ãªã•ã„ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚\nExcelãƒ•ã‚¡ã‚¤ãƒ«(.xlsx)ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
    }
}

function render(workbook) {
    tbody.innerHTML = '';
    let count = 0;

    workbook.SheetNames.forEach(sheetName => {
        // ã‚·ã‚¹ãƒ†ãƒ ç”¨ã®ã‚·ãƒ¼ãƒˆã¯ç„¡è¦–
        if (sheetName.match(/è¨­å®š|ãƒã‚¹ã‚¿|config|list/)) return;

        // ã‚·ãƒ¼ãƒˆã®ä¸­èº«ã‚’å…¨éƒ¨ãƒ†ã‚­ã‚¹ãƒˆã«ã™ã‚‹
        const sheet = workbook.Sheets[sheetName];
        const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        const fullText = json.map(row => row.join(' ')).join(' ');

        // 1. ã‚¿ã‚¤ãƒ—åˆ¤å®š (A~D)
        const type = analyzeType(fullText);

        // 2. æ–‡ç« ç”Ÿæˆ
        const policy = makeText(type, 'policy');
        const long = makeText(type, 'long');
        const short = makeText(type, 'short');
        
        // 3. ã‚¹ãƒ­ãƒƒãƒˆç”Ÿæˆ (1:ç”Ÿæ´», 2:ä½œæ¥­, 3:å°±åŠ´)
        const g1 = { t: makeText(type, 'slot_goal', 1), s: makeText(type, 'slot_supp', 1) };
        const g2 = { t: makeText(type, 'slot_goal', 2), s: makeText(type, 'slot_supp', 2) };
        const g3 = { t: makeText(type, 'slot_goal', 3), s: makeText(type, 'slot_supp', 3) };

        // 4. è¡¨ç¤º
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td style="font-weight:bold;">${sheetName}</td>
            <td><span class="badge badge-${type}">ã‚¿ã‚¤ãƒ—${type}</span></td>
            <td style="white-space:normal; min-width:300px;">${policy}</td>
            <td style="white-space:normal; min-width:300px;">${long}</td>
            <td style="white-space:normal; min-width:300px;">${short}</td>
            
            <td class="col-life" style="white-space:normal;">${g1.t}</td>
            <td class="col-life" style="white-space:normal;">${g1.s}</td>
            
            <td class="col-work" style="white-space:normal;">${g2.t}</td>
            <td class="col-work" style="white-space:normal;">${g2.s}</td>
            
            <td class="col-future" style="white-space:normal;">${g3.t}</td>
            <td class="col-future" style="white-space:normal;">${g3.s}</td>
        `;
        tbody.appendChild(tr);
        count++;
    });
    
    document.getElementById('countText').innerText = count;
}

// æ–‡è„ˆè§£æï¼ˆç°¡æ˜“ç‰ˆï¼‰
function analyzeType(text) {
    let scores = { A:0, B:0, C:0, D:0 };
    const keywords = {
        A: ['PC','å…¥åŠ›','å°±è·','ä»•äº‹','ã‚¹ã‚­ãƒ«','è³‡æ ¼'],
        B: ['ä½“èª¿','ç—…é™¢','è–¬','ä¼‘ã¿','é…åˆ»','ä¸èª¿'],
        C: ['ä¼šè©±','ãƒˆãƒ©ãƒ–ãƒ«','æ€’','å£°','å–§å˜©','èˆˆå¥®'],
        D: ['æœ','æŒ¨æ‹¶','å¿˜ã‚Œ','ç‰‡ä»˜ã‘','æƒé™¤','ãƒ«ãƒ¼ãƒ«']
    };
    Object.keys(keywords).forEach(k => {
        keywords[k].forEach(w => { if(text.includes(w)) scores[k]++; });
    });
    // ä¸€ç•ªã‚¹ã‚³ã‚¢ãŒé«˜ã„ã‚¿ã‚¤ãƒ—ã‚’è¿”ã™ï¼ˆåŒç‚¹ãªã‚‰Dï¼‰
    return Object.keys(scores).reduce((a,b) => scores[a] > scores[b] ? a : b);
}

// æ–‡ç« çµ„ã¿ç«‹ã¦å·¥å ´
function makeText(type, mode, slotNum=null) {
    let text = "";
    const p = DICT.types[type];
    const rnd = Math.floor(Math.random() * 3); // 3ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚µã‚¤ã‚³ãƒ­
    const sub = getRnd(DICT.sub);
    const adv = getRnd(DICT.adv);

    if(mode === 'policy') {
        const intro = getRnd(p.intro);
        const focus = getRnd(p.focus);
        const end = getRnd(DICT.end_policy);
        if(rnd===0) text = `${intro}${focus}${end}`;
        else if(rnd===1) text = `${intro}é–¢ä¿‚æ©Ÿé–¢ã¨é€£æºã—ã€${focus}${end}`;
        else text = `${focus}é‡ç‚¹ã‚’ç½®ãã€${intro}${adv}${end}`;
    }
    else if(mode === 'long') {
        const t = getRnd(p.long);
        const end = getRnd(DICT.end_will);
        if(rnd===0) text = `${t}${end}`;
        else if(rnd===1) text = `${sub}ã€${t}${end}`;
        else text = `${t}ã“ã¨ã‚’${adv}${end}`;
    }
    else if(mode === 'short') {
        const t = getRnd(p.short);
        const end = getRnd(DICT.end_will);
        text = `${adv}${t}ã“ã¨ã‚’${end}`;
    }
    else if(mode === 'slot_goal') {
        const s = DICT.slots[`slot${slotNum}`];
        const act = getRnd(s.acts);
        const end = getRnd(DICT.end_will);
        if(rnd===0) text = `${act}ã“ã¨ã‚’${end}`;
        else if(rnd===1) text = `${adv}ã€${act}ã‚ˆã†${end}`;
        else text = `${act}ç¿’æ…£ã‚’${end}`;
    }
    else if(mode === 'slot_supp') {
        const s = DICT.slots[`slot${slotNum}`];
        const sup = getRnd(s.sups);
        const end = getRnd(DICT.end_do);
        if(rnd===0) text = `${sup}ã‚’${end}`;
        else if(rnd===1) text = `${sup}ã‚’é€šã˜ã¦ã€${adv}${end}`;
        else text = `${sup}ã‚’ä¸­å¿ƒã«${end}`;
    }

    // â˜…é‡è¦: ã‚‚ã—åŒã˜æ–‡ç« ã‚’ä½œã£ã¦ã—ã¾ã£ãŸã‚‰ã€ä½œã‚Šç›´ã™ï¼ˆå†å¸°å‡¦ç†ï¼‰
    if(history.has(text)) return makeText(type, mode, slotNum);
    
    history.add(text);
    return text;
}

function getRnd(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

// --- ä¿å­˜ãƒ»ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ ---
function copyToClipboard() {
    let txt = "";
    // ãƒ˜ãƒƒãƒ€ãƒ¼å–å¾—
    const headers = Array.from(document.querySelectorAll('#resultTable thead th')).map(th => th.innerText).join('\t');
    txt += headers + '\n';
    // ä¸­èº«å–å¾—
    document.querySelectorAll('#resultTable tbody tr').forEach(tr => {
        txt += Array.from(tr.children).map(td => td.innerText.replace(/\n/g,' ')).join('\t') + '\n';
    });
    
    navigator.clipboard.writeText(txt).then(() => {
        const btn = document.getElementById('copyBtn');
        const original = btn.innerHTML;
        btn.innerHTML = "âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
        setTimeout(() => btn.innerHTML = original, 2000);
    });
}

function downloadCSV() {
    let csv = "";
    // ãƒ˜ãƒƒãƒ€ãƒ¼
    const headers = Array.from(document.querySelectorAll('#resultTable thead th')).map(th => `"${th.innerText}"`);
    csv += headers.join(',') + "\n";
    // ãƒ‡ãƒ¼ã‚¿
    document.querySelectorAll('#resultTable tbody tr').forEach(tr => {
        const row = Array.from(tr.children).map(td => `"${td.innerText.replace(/"/g, '""')}"`);
        csv += row.join(',') + "\n";
    });
    // Excelã§æ–‡å­—åŒ–ã‘ã—ãªã„ãŠã¾ã˜ãªã„(BOM)ã‚’ã¤ã‘ã¦ä¿å­˜
    const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
    const blob = new Blob([bom, csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'æ”¯æ´è¨ˆç”»ã®ç´ _ä½œæˆãƒ‡ãƒ¼ã‚¿.csv';
    a.click();
}

</script>
</body>
</html>